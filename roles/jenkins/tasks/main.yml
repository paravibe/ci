---
- name: Add Jenkins apt-key
  sudo: yes
  action: apt_key url={{ jenkins_repo_key }} state=present

- name: Add Jenkins repository
  apt_repository: repo='{{ jenkins_repo_url }}' state=present update_cache=yes

- name: Install Jenkins
  apt: name=jenkins state=present
  notify:
    - restart jenkins

- name: Change Jenkins port
  replace: dest=/etc/default/jenkins regexp="^(HTTP_PORT=8080)$" replace="HTTP_PORT={{ jenkins_port }}"

- name: Restart Jenkins
  service: name=jenkins state=restarted enabled=yes

- name: Copy nginx vhost
  template: src=nginx_vhost dest=/etc/nginx/sites-available/jenkins

- name: Enable vhost
  file: >
    src=/etc/nginx/sites-available/jenkins
    dest=/etc/nginx/sites-enabled/jenkins
    state=link

- include: plugins.yml