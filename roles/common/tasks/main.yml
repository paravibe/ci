---
- name: Generate password hash
  shell: python -c 'import crypt; print crypt.crypt("{{ rootpasswd }}", "$1$afRgT$")'
  register: rootpasswd_hash

- name: Set new root password
  user: name="root" password="{{ rootpasswd_hash.stdout }}"

- name: Set timezone
  copy: content="{{ timezone }}"
        dest=/etc/timezone
        owner=root
        group=root
        mode=0644
        backup=yes

- name: Install curl
  apt: name=curl state=present

- name: Install git
  apt: name=git-core state=present

- name: Install zsh
  apt: name=zsh state=present

- name: Clone oh-my-zsh repo
  git: repo=https://github.com/robbyrussell/oh-my-zsh.git dest=/usr/local/src/.oh-my-zsh

- name: Copy .zshrc
  template: src=.zshrc dest=~/

- name: Set zsh as default shell
  user: name=root shell=/bin/zsh

- name: Add sudo group
  group: name=sudo state=present

- name: Generate password hash
  shell: python -c 'import crypt; print crypt.crypt("{{ passwd }}", "$1$afRgT$")'
  register: passwd_hash

- name: Add new user
  user: name="{{ user }}" shell=/bin/zsh comment="{{ username }}" group=sudo password="{{ passwd_hash.stdout }}"

- name: Copy .zshrc
  template: src=.zshrc dest="/home/{{ user }}"